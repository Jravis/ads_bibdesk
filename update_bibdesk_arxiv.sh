#!/bin/sh
# ADS to BibDesk -- frictionless import of ADS publications into BibDesk
# Copyright (C) 2011  Rui Pereira <rui.pereira@gmail.com>
# 
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.

# ugliest hack in the world - harcoded/compressed strings of both applescript and python scripts as in the automator actions
py="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"
scpt="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"
tmpdir=$(python -c "import tempfile; print tempfile.mkdtemp()")
python -c "import binascii,zlib;\
           out=open('${tmpdir}/py.py', 'w'); print >> out, zlib.decompress(binascii.a2b_base64('${py}')); \
           out=open('${tmpdir}/scpt.scpt', 'w'); print >> out, zlib.decompress(binascii.a2b_base64('${scpt}'))"

# go the tmp directory
cd $tmpdir

# fetch arXiv bibcodes from BibDesk using an applescript
bibcodes=$(cat << EOF | osascript -
tell document 1 of application "BibDesk"
	set bibcodes to {}
	repeat with thePub in publications
		if (count (every field of thePub whose name is "Adsurl" and (value contains "arxiv" or value contains "astro.ph"))) > 0 then
			-- get bibcode from ADSurl
			set ADSurl to (value of every field of thePub whose name is "Adsurl")
			set AppleScript's text item delimiters to "/"
			set end of bibcodes to last text item of text item 1 of ADSurl
		end if
	end repeat
end tell
set AppleScript's text item delimiters to " "
return bibcodes as text
EOF
)

if [ "$bibcodes" == "" ]; then echo "Nothing to update!"; exit; fi
# check for changed bibcodes
nbibcodes=$(echo $bibcodes | wc -w)
python -c "import math;n=$nbibcodes;t=math.ceil(n*15./60.); print 'Checking %i ArXiv entries for changes...\n(to prevent ADS flooding this will take a while, check back in around %i %s)' % (n, t, t > 1 and 'minutes' or 'minute')"
python py.py -u $bibcodes
# python py.py -u $bibcodes --debug # DEBUG MODE

changed=$(wc -l changed_arxiv | awk '{print $1}')
if [ "$changed" -gt "0" ]
then
    echo ""; echo "Updating $changed entries, continue? (y/[n])"
    read -n1 -s continue
else
    echo ""; echo "Nothing to update!"
    exit
fi
if [ "$continue" != "Y" ] && [ "$continue" != "y" ]
then exit
fi

echo "(to prevent ADS flooding, we will wait for a while between each update, so go grab a coffee)"
# update bibcodes
for bibcode in `cat changed_arxiv`; do
    echo "Updating $bibcode..."
    # sleep 1 minute if updating a lot of stuff, if not wait only 10s
    if [ "$changed" -gt "10" ]
    then
        sleep 60
    else
        sleep 15
    fi
    osascript scpt.scpt `python py.py ${bibcode}`
done

#clean up
cd - > /dev/null
rm -rf $tmpdir
