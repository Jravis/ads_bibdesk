#!/bin/sh
# ADS to BibDesk -- frictionless import of ADS publications into BibDesk
# Copyright (C) 2011  Rui Pereira <rui.pereira@gmail.com>
# 
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.

# ugliest hack in the world - harcoded/compressed strings of both applescript and python scripts as in the automator actions
py="eJzFPGl32ziS3/Ur0PKmSXYk+kg6SasjJ+44nnheDj/beTNZ26uBSEhiTJFskrKjTWd/+1YVABI8JMuZvF1+sHkAhUKh7gK09dP2Iku3x0G0LaIblizzWRx1ut1u5+DwjOUx+yMYH4rsmvX7bJIGXh7EUSiyjAXzJE5zFk8YNkwW4zDwOH6FT1HZr/MqTpZpMJ3lzH7lsL2d3V3GThcBOxGpCFLOnqeLwE3kw8vpnAeh68XzfcYjv8Narr/HEc9nPGJngXfNnn9Wjxk8vZxzjzp3OuezIGNJGk9TPmdwO0mFYFk8yW95KgZsGS+YBzBS4QdZngbjRS5YkOOg23HK5rEfTJYdeLGIfJGyfCZYLtJ5htPFh7+9/8j+JiKR8pCd0NTZ28ATUSYYzyQxspnw2XjZweZHOPqZGp0dxQCVSNVjIoDvKbsRaQbP7JEeQEHrsTjt2DxHhFMWJ9jJASyXLOR52c9tTriclw/rQTBncQLTmAE0mNhtEIZsLNgiE5NF2OtAS/aP4/M3Hz6es4P3n9g/Dk5PD96ff/odWgJLwFdxIyQcWPkwALAwmZRH+RJw7rx7ffrqDbQ/+OP47fH5J0CbHR2fv399dsaOPpyyA3ZycHp+/Orj24NTdvLx9OTD2WuXsTOBCInOGnJOaDmAar7IgTcymOonWLwMUAp9NuM3AhbRE8ENIMSZB8x29xp1eBhHU5oYtCzpBhgdT1gU5z2WAWbPZ3meDLa3b29v3Wm0cON0uh1KCNn2PiDyB89gVFi2UlR8FBW+yOM5zwFzTvKCbFBh2x5rY9seO1hMF1kOQrLztNM5jhKg+pwvcZniSOh5TeIwjG+DaDro9GlkPoalhpFYwqeCfTx9q96Pg7EX+wKeePrP4Kbarngb+CLKg0kgUpJ6JdbZMtO3cXGXCn2XB/PiHrgy4WlWfhPzZBKExXMWe9ci7+hHbxro20UahsF4z3iUgIqeizGsjIfaBqQqSzqTNJ6zN+fv3p5gu1TroPKNbDHL5yFOKl/6YlJoqojPxR4SJIlBQXU6W8BSE74I5WyQw5HXAAnQDGGYdSTebiZy1U41sx/tOJ0OvIO1CSLbGZCaQtrhf8JDSWqG+gQkdRF5M2rMwjhOKs0TOZFhQUX3A3WV07Edo5HLfX8kAdtW37d6zOr3fTFeTOEW+C4fdump29MTGx7xEHWI5MJhNwOWFKM8XYjuasALCXiRgIoSI55+CW6szSGqiUOLNA+8UBwfwtzUMPQPIE4zmBe13gIBBXZMxQT0fwQLzWj9bAmFhw4IdDQJpoz4iTBOcUWH7KTso4gUTPTgLpFhUFgP6nNhSVJdQedzwFcjMIdZBUkIejudLubANRnra8nJUKhBMBPU2qQtQKzqg5mEQrUHnGcXk3fYPtstMfFA4qegMnC5oZmlngsqW7eWUzRGbgQLoXBBJS4iwDCF0YwBBhUjucWyUIiE+u7+CloM6OfDasA8gAqgwHPSDBPgQx80SKUvsrdL3e3dX53KJ5hulYiDhmlOUhAq1lXYdgu8a+iBAkMbCfQ0NFQGClJzWKU99zNQZ0AurRpcuFlEGdif3LYt1M9ANYUaNB7NgzSNU+sKSAnabvtBZrEHehR4hyS2nO+dm8QGpiZvajMj/EhB48xQJZVca8wHJgPfS41l0+BD+uvUG0uRseV4/wbaLpAgF18k6uqhDq38gu7DezA4A5hVBVc2AQssmm7ZBrgY+BwdHL/9ePp60DLiT91GR2DgPIgWYjW6rpaQn4Z6qVfRwnoQuOxBBm4DsBzIxlwwySJ29HC3VzJKE7izAuL+vhbqdo4XoC43wQacDg2ogU9z7AZRVFfXC2Pgl0K7RnE659KedZrYbLFDgV5tAL7FLbqFt8IiR4uHgXKPXHYODD2NAUhA2nAK+pqjjyGdfK0PJbhCXIlt4bbUUxc7V0pQy9k02aZgWdkNBrwWUdcwJgCmnHMcRcJDL4tE6pV+/N5BwdEnLxJUDAxZQHdr0g4AKt9OBfcLiamsFPhQrvgCmkqthyTSXXpiYx1R6ocGPo45nj8BtwNYgIYBUxDk+G8SpOBpgqc6i9Ne4RoSz6FAVhh5i308P+o/A/uDr0v5V2xsuZ/Bo7LnPLFDPh/7nH0ZsC+ubG1bi3zSf2Y5PXaBGAMDnRwe2fBo/fXXX1avVVNsciEwNZcfAEkSghjmR0AryPkDgClFNBoBzNHIdq7AgHW8kINXXGH7ePwZbkp39FSGRRiOYyBhkzA56Mql9JrLuAXYvUd+Ks/Rc8+V00NQCRQ8Ird6cZqKLAF/ApVDM+4g/0h59GimycNxXAJBf85x/Ixsfw7eqoxL4xTj63gyKNthYPKlEphk6n3hLmxDeDsNcuBpOWmjLbMPPxw7qoOaX1aBW7zQPji68qNREAU5kDcT4aQnFY/WHaVUZ4sEpNGkOkaK4cRxi/6l6OEHlwCBPAOl1AJUv2t/lv5XPxXaFDULenYQzwPl8V1N8+rmpIqK9ry+GnpVMSJtgwDNQN/kWc3fkt6WRB7RWCRJnCEmQY56j6yBqeAOokZk+cLUnjTWKMik12vXPFjdYEPnhnIparzjw27PoLqJUuFFU3wBMy8xEmFAMX+VBm7mzQS4BygYBcIKyA9B2XB/gZ2BZ9txb/oPW5ijQIFMOAhcyL1r8CBkogL4Fh5xXTDnIDy+UJZGcuEv80WW/4LZBGnBo/i2Po+CDtTDzXKkBUq23VVjdJ3mxCqcbqmGFnvYNqHNuK3suAHLlWxXUUg8p0QZElqGBSwLcvGidemKZY9EDsYSNVO5pChaEkJW5QeMOHCoOkPchylaGQOBtvOD5AkA3iXp6RaY1mdQRRTb/nhUpdg1kS21aiHlpCVLkKB6z9MlWRo0ZMFkafApJ9sklbXy5XSitITQZ5G4BZ24BDfR/vTp3Tv3PVwOJUzLNnHo6zYceCPuJ7NtbIxNi2aDVOSLNBpQXgCpoZcAeS2FMOFGpIbXo80GXoTkCVrOFHk/FZjHS8DPsi370v/6uPfkm6v+/0UIXCIG8ObpN8cI9QnMO56DzkF5MKG6kyDywX83RcLUpjLdUHZ32HBophwK8JSJMVuavjReVaOzNuI22aUSdt/X0bG8adDH2gOowtGfC5EuMUQnvhrIyEzh3hK4bzHFQmTbtENNuU2zmVxcJQspWEjbmKizRtGqjpTxKr0TzdbaFrQwNjg3uDIlQ5euEzlXyvHS2h8UE6p/g6v+r1fC8uNA5UpKLmtJl9xByqrYa924CYFIp2PmtaRORZebxNnCkgXDckip2YuPCGNYVYj3oSrcK8P/gyiLANFO9+iOGFzeTlI+xWzj5tTFJk3F+t00VurVpLJbJTOG+glPMM1eetfkPyEF0b4EkXS+VSaA0fw2WgsaPUBn1dpW4aMmlSvXAt47F3uDK6f3/ycWmymnwL+fmFQXsviu04rVdTyQQRmVtkznXbaFifIb9ItwmRESfGqQC9+7q41dtvCwwoJFQKnrWIyW9jbIhIlIcZ+ny1qaoxp91ENANSuXJuq0aVhKx+t34osnkqI05L45Pz95jWu3RjfraNisCdSD4Xc8Ag7PpONs1BuAmn6AJTtiZzYX8zhduiYoClg50Ug5ARTpjpewJr6sh/N02Q+Da8zRg8mecE+4RYDZHmGaMWXBqifo0A9ZnEk5IKmIKWMiohvbevPh3WtMo1hI7LEsNVq1cHJkuKpDRrwPIu7OeHrDU98V/uKOZITlQQ8/cxd9VAzZeAqa6q4ui2vsAaFDDqw443OXe+7i+q5eIouxG/zDwupdrSmrkgbuIgr6MwEKKRyLdOr6YpOOQcQzHrnpnZPHxnMeu9eBuHEXfCOk0Ktzk4XneuEm7ePIHd9JUaIn4AGE/Jxs0ngsG3vRRuRYeJy74FuKHEhzVw+sfmOvMEgCdxq7gW9ddVq4V+v6EfDroazloBRlNkZwb4D7KKfo6zpPZghPAQ1c+pM6rBJICAyDxj9VVUCyRSi9LdiospytIWJ/9ONTYJ0SBZmzKiDWZOlaLAtMJFB8U8/wjCCoTI8jX3yBtv1dU+ABe/g4L7JK0N0QfNNMSFMF36/M/lmzf4/d8HAhWvUH9QckqMWmczH1E0ykqZ8MNMvGkfiS1xuWqZ2SIEOKT0oUnP5ui/Gok9BskHIwROwsj5PjHGufwDEr6f8QIp92K4xjX9Sam6Su82zToSrspqn1iy0ZizCEkWg3lN5UYFgZrKIEJXfh7hxM0YG98bjK0CATWpnRibL12HQeZJT64Lj8fVpbcMuC1DWxq8/6a7f0eroDqgHW7EC3KfYypVD2wjxiSys/vo1QFEeJP+lKP6KlVZbNRjip1XCwBTS4WddGbmgYSEP/rbpgq1aK/JDKngKgpNIW/6pa23/1mAd+SU6OgOH4VDxhrd2+fjOcY9kNmaGx3GrlMJkWgTsTZLlZaVdJNm3k6bucRYmW0yYjtylwblWxlmoY6/0h5dMTLW+roGHOwMVccmI75PYgOsUbM+VnbVnt2SJraFEv3NDSnibaYmPuh0vEay4wEZXn9e0G+mot8OJ1DboOyG6gJgODodUsiCqq3rRjc6OS4o2PlEm7KQYI41vcc4Pzsi3c1IL+/lJkbWTQcCvO6yZwJ8jKCDiK18Et0w4bAAY9C+AiYd1z/spskNHo1HWINImlyDUZsCl7xf0Z1YlbdKGUDvt/tg0v1mkFoeWuhaVrO2WKUjw16CGULTM7UOrC4YMMN37JxKX6usXsUOA+QtruiVoc4iudOTdbMto4Rrs65X7McginY+pONYpWlOzk8Ch70TH1pmpBg9GOGDUkgYVgI15ElMTnsBjzGBTNnHszrNOjoE9Ejg9TxFwSVvgODgIGBDe20qbIKFZBiyz+hsuO1sg4dql74QnIhVsOVsbM1WjamOeqeLqSTTZmXYelMdoETomxdWUoPunLVLY9vExSYJk0XxasWwZFa5wbM3YqQso/gvG5+DJYEcVRKmeFALySBkICAMkHvUq2QdWf9AdzZ4HZXZXhm+E0jkixdAjsYDqjRQ+LqYzKRannC/sgW105+kuzu7y5SIWbCZ56YAZeXhz0//Pq4eVXS28PUGbCdgZlCllmDpeJTp0Vm2noKYgmceF/YtoGPtsKWMXlzVe7oFZPT8x6WVaXYES4t74Wb9TAV/B8YT3IhmqHT9BjnyUh8K6omyBiLnrZGVbWEdI3q0SoQFUut0K4fcXlzk9j/4RMjLWEORWHTZYNNK3tF8+H//XSsV+cPMeZ7UvSO1/xhZrY/uXZQ2qAqO/33IfOt/8oV6ZcDwVYGk27d5ld3j68zIaXmQOtU3eaxovEthCImbxSC4VY2xd2cLE7uAJ2S0LuCTS9lOrSzAN01LdVyv43vMqg62APJf5iD2+AuvUFLZDAqWJqo3ihporvEKGOseHhNSWIcK9qcacWJIEWZktjA01566wW5l9wayr8++X6Fu+MZS67u9U0TpX7QSSva56i5FE+Rbm0qm/BhR2BU96w9fSRti8HQkGrfitEtWLTZRpO53PbPtJumRZE5N4XzBetCuwlQRBj26J3wAeVHbiOW/MW5mCl5+E6D0FuzQcVaYRTFI+/g67v3rL+PljjgOQIXER9QAL1ZwHC2J9/+4i252PfbQ/CHKAB9NgeL3mYzLiLO8Jbsbh9ZJSsNwRUkk/OsinBz4Ea+4770H4xfL5N91avoclvH+mkaA/7H344P3j71lESYBSmKpyg3xYKXaJwMejvXmlZv4zqjmUm/Wj5uVfzn7eCaUQHLOLFGPhjBqxFUSZ4DpjTtD7u7O09edLf2Xn06JlV6YmhQL8IBUDgW4rGWwCP+8ILcCMirCl6ahJ8T+63hzWepY1uetYXWKbUSgb9VOiPqqV4hwqqx3afNJSLhkDvqwr9TuN9JOQ+QKnB6ejNbWQePMC4SW7km1AlvLal9u58+QRGkOUmI96i4oUMylaafTDm8pSCuccPs+T6FEPJONVMOngalEjvMZGmjZDwHhtYwKbSWD4QJpd83ZKxqWhqGNHw2TYZTu0zqG4/Jv06qGUuZMtS/1bGseTCWIW5lyCa61HoVOmX2WXjCw3jyml20yq1Jv9fpex/c6yeCZ6cjQuLOgE4Leqlff2q7Gvx4pt80Ry41Nm84uRxmOm6fO69EJWDmJgqFUIsajlXVdmawdtQjIijweTprXR82sO9halpULe0oTIXC1pWItpZapXbWJS1bCs9lTZPW9siQAbFY+5BbXZeZYTLFa7b7i05Tbm1xONRhAfP5C6VrKinlsk+itjrMwvm042mhoM/VM6YJCEEQqlnGS7Zz1uPnv2OUkh61H70zPDltqRArEWFWw1dAIQXExIZY+CmNsBWrIYc9dwQO31RZRUAedNAHRH6M7ObW8IQtCNL6K35n8JnRMSpWXsyBJsiXUbkdN7RuFgJqQqo5YXR/QqtkyInWidEshUQ0d7yec7/jXHL7q3j1gURmyshxNuWVP3dnAf9ytUEx6KH4aW5n30spkEUYYI6npTbCcgqmsMRIK2okO8OVFOrZfBSKI2TWkrs0AGr2nZjxvLQH9BCTRuP/G06bUwhQnNcmOpJweYKeYBZtc0FPl41GpqkVCLgOfWN8ZVe7edFtijlo3y9VcnPStywIi3rcW8mPe7VCRfD4aRn5cq3J10VxTYY29PwCteunWbfR7fVtKN5A31mdKYlTq/xqE6R8ONZ36jMrMLB+hmzCzTZh8z63aqyZBGmQLiAu+0ZIVjnTfz6fZzZQg30gglEkyrFuOqkxZoQ7Ii4ChpJW6RIovKFOBFOh3njFGMzzNuWNafzNJDH9mgDv7ktU2cktVFc84ktZGUrosJLkeO0MS2qc4PsZ1am/hwDmNp8CsoJHUDjgwiFl6cxEIp9Btc9grgDtWgrBUzRaXENdeJJnnsrfQClzc3UZnXLcFFYWZ0KbR8J++h2OGLRCFcUlwDVv403NQ4ygGSJeyLPl1KuXea/dBfw82YiDIftZbsK2+UQEeZDhHZ88vrOtuDj67aYIMK+es+PEaloFqg46Yod1nrpxm4y5ZbrXlUVgluj370/PTijrdHQC08xniUQgNJBOPWLAtQCk6+0IRNPvMncQzBJgUbNwEef0qZ+KqdULm3L4UDjxLNdCdYMPHUjf0Ln6eQhwOYxsioFKp3qe+Ah1izS/RV0fPTU9MF8d36NtzZlOxGSVQeDmweRTBRXYhTAIlE799kIa/EirgOAWJ8ZQxxDJSN7TSxbM34b7f2SOPqL+XzZPGFbx6JAwqIOpuuiVsFC/efHHh3+JhYsxAxgtPi9ujzmT9rIH0S6ZCNVVq0J1meQlsh2qObOzt6o307B8j7RGu2j/CUVWgP6gQpojabrp5qvgOgXRZQWDdRebFnPavfiFby8Oe3jBPigal4+yNhlN48XYFjKAh92/J3d4o7S/ofae3Z52X2QwZ/LrlUvQxkFopXFoB5rlS/Aao/Q8hLW/1NiNqiNrCoD9x8RGaPp7Gm1C0NXtGxdkza0pRfP52jYccPSerh7PxLw9zA/Xm0CoGqqFbWubfNavb5lnCK5Q+EX8KoaXxVnW0rclCQN5E6bNiXUvrnh+Wx3/zmnkGrY3e7uE/oIpp0axfBGaqUOwnZ/4enFl39eBTeYXcZsCwJsc2HJsfAG5ZbrO4an+Ks6eqX7sKsHA0+xvgG3SutmzI39LmiEQX9vfVivo9H2AeSmffW7OKDrFNG8WZwJ/Hmc4vhGbT9/bW3savm5yDyXWg9/M6PmdlUr1jK9qsa/0+a2E6f1vIAEqTJlu07vXnv/GzywegL/NqJrqvnfjbM8LSAlGVRKa5t7Gxa8NvYoSuaE+AnTFAjSafcz9PW9ChAvQwm2fV4dixqdMXNeatBm3FLRpkK9XKtNzf0MSmsW/a4aO3yKuEbmcTHEQNdvNI9SnumTgqt/caf9d3UIFP7BlA9a4OfSqWaBP+wCuQ4VsbssS72hPlYaR6hrYFEx1nRvAa0lWq9t+oGh7d0ddxeu7c/u7qMnv/b3fnvyxN3bwbfPdp8+dr9s8wycqZWfkb1e3Ax3f+bz5Pd8OE2e/iqmj/+kx2zoPRXeo8neE3/vyW+TXyePd589ffrbb5PJkwmfPH4sxmJndzwe7+x2IUTw89mwu7uz86DLZgJ/1E497T/flrPcl2zcGjAYscJWNUIggheHQ9QnKhFR4k5RG+scNfdfFbtplA0L4yZGlbI4toTY+I1MasgIqRGx41Ym40z/x4hqhDJ+V4yGPzektHn3CDfGnmogf1fh+IEE1qWDRFS1IGBySD0S5dXkeTlKUYj5WPi+/NUAHqlITe6slYdIIXwwcu+IAnZDpTgNbowTgigX5fkM4tTmXoD6yf8NdwCsOc6vwjzDTSnGXluUlNtK1Kl/SSKcV/1Y3Poy493x19pq4aoSo9JN9ykeyhkU9cOBcsLbi4g1vqYyYoVy9yg5mcRS6TGp6DAd03QHMzDjWA4U4LQEk0V4hma9jZIV0wKglN8Kzenorm1JTrV06cZsLrM0hAWZwPVWTgJvLl0toVWr8HTl+N3akWCgzmFARTOjgNNkoIJrdQc9i0rTToAChOml0Yiy+6MR/tzdaKSy+/KH8pTmM01M538BcssPLg=="
scpt="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"
tmpdir=$(python -c "import tempfile; print tempfile.mkdtemp()")
python -c "import binascii,zlib;\
           out=open('${tmpdir}/py.py', 'w'); print >> out, zlib.decompress(binascii.a2b_base64('${py}')); \
           out=open('${tmpdir}/scpt.scpt', 'w'); print >> out, zlib.decompress(binascii.a2b_base64('${scpt}'))"

# go the tmp directory
cd $tmpdir

# fetch arXiv bibcodes from BibDesk using an applescript
bibcodes=$(cat << EOF | osascript -
tell document 1 of application "BibDesk"
	set bibcodes to {}
	repeat with thePub in publications
		if (count (every field of thePub whose name is "Adsurl" and (value contains "arxiv" or value contains "astro.ph"))) > 0 then
			-- get bibcode from ADSurl
			set ADSurl to (value of every field of thePub whose name is "Adsurl")
			set AppleScript's text item delimiters to "/"
			set end of bibcodes to last text item of text item 1 of ADSurl
		end if
	end repeat
end tell
set AppleScript's text item delimiters to " "
return bibcodes as text
EOF
)

if [ "$bibcodes" == "" ]; then echo "Nothing to update!"; exit; fi
# check for changed bibcodes
nbibcodes=$(echo $bibcodes | wc -w)
python -c "import math;n=$nbibcodes;t=math.ceil(n*15./60.); print 'Checking %i ArXiv entries for changes...\n(to prevent ADS flooding this will take a while, check back in around %i %s)' % (n, t, t > 1 and 'minutes' or 'minute')"
python py.py -u $bibcodes
# python py.py -u $bibcodes --debug # DEBUG MODE

changed=$(wc -l changed_arxiv | awk '{print $1}')
if [ "$changed" -gt "0" ]
then
    echo ""; echo "Updating $changed entries, continue? (y/[n])"
    read -n1 -s continue
else
    echo ""; echo "Nothing to update!"
    exit
fi
if [ "$continue" != "Y" ] && [ "$continue" != "y" ]
then exit
fi

echo "(to prevent ADS flooding, we will wait for a while between each update, so go grab a coffee)"
# update bibcodes
for bibcode in `cat changed_arxiv`; do
    echo "Updating $bibcode..."
    # sleep 1 minute if updating a lot of stuff, if not wait only 10s
    if [ "$changed" -gt "10" ]
    then
        sleep 60
    else
        sleep 15
    fi
    osascript scpt.scpt `python py.py ${bibcode}`
done

#clean up
cd - > /dev/null
rm -rf $tmpdir
