#!/bin/sh
# ADS to BibDesk -- frictionless import of ADS publications into BibDesk
# Copyright (C) 2011  Rui Pereira <rui.pereira@gmail.com>
# 
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.

# ugliest hack in the world - harcoded/compressed strings of both applescript and python scripts as in the automator actions
py="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"
scpt="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"
tmpdir=$(python -c "import tempfile; print tempfile.mkdtemp()")
python -c "import binascii,zlib;\
           out=open('${tmpdir}/py.py', 'w'); print >> out, zlib.decompress(binascii.a2b_base64('${py}')); \
           out=open('${tmpdir}/scpt.scpt', 'w'); print >> out, zlib.decompress(binascii.a2b_base64('${scpt}'))"

# go the tmp directory
cd $tmpdir

# fetch arXiv bibcodes from BibDesk using an applescript
bibcodes=$(cat << EOF | osascript -
tell document 1 of application "BibDesk"
	set bibcodes to {}
	repeat with thePub in publications
		if (count (every field of thePub whose name is "Adsurl" and (value contains "arxiv" or value contains "astro.ph"))) > 0 then
			-- get bibcode from ADSurl
			set ADSurl to (value of every field of thePub whose name is "Adsurl")
			set AppleScript's text item delimiters to "/"
			set end of bibcodes to last text item of text item 1 of ADSurl
		end if
	end repeat
end tell
set AppleScript's text item delimiters to " "
return bibcodes as text
EOF
)

if [ "$bibcodes" == "" ]; then echo "Nothing to update!"; exit; fi
# check for changed bibcodes
nbibcodes=$(echo $bibcodes | wc -w)
python -c "import math;n=$nbibcodes;t=math.ceil(n*15./60.); print 'Checking %i ArXiv entries for changes...\n(to prevent ADS flooding this will take a while, check back in around %i %s)' % (n, t, t > 1 and 'minutes' or 'minute')"
python py.py -u $bibcodes
# python py.py -u $bibcodes --debug # DEBUG MODE

changed=$(wc -l changed_arxiv | awk '{print $1}')
if [ "$changed" -gt "0" ]
then
    echo ""; echo "Updating $changed entries, continue? (y/[n])"
    read -n1 -s continue
else
    echo ""; echo "Nothing to update!"
    exit
fi
if [ "$continue" != "Y" ] && [ "$continue" != "y" ]
then exit
fi

echo "(to prevent ADS flooding, we will wait for a while between each update, so go grab a coffee)"
# update bibcodes
for bibcode in `cat changed_arxiv`; do
    echo "Updating $bibcode..."
    # sleep 1 minute if updating a lot of stuff, if not wait only 10s
    if [ "$changed" -gt "10" ]
    then
        sleep 60
    else
        sleep 15
    fi
    osascript scpt.scpt `python py.py ${bibcode}`
done

#clean up
cd - > /dev/null
rm -rf $tmpdir
