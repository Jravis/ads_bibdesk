#!/bin/sh
# ADS to BibDesk -- frictionless import of ADS publications into BibDesk
# Copyright (C) 2011  Rui Pereira <rui.pereira@gmail.com>
# 
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.

# ugliest hack in the world - harcoded/compressed strings of both applescript and python scripts as in the automator actions
py="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"
scpt="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"
tmpdir=$(python -c "import tempfile; print tempfile.mkdtemp()")
python -c "import binascii,zlib;\
           out=open('${tmpdir}/py.py', 'w'); print >> out, zlib.decompress(binascii.a2b_base64('${py}')); \
           out=open('${tmpdir}/scpt.scpt', 'w'); print >> out, zlib.decompress(binascii.a2b_base64('${scpt}'))"

# go the tmp directory
cd $tmpdir

# fetch arXiv bibcodes from BibDesk using an applescript
bibcodes=$(cat << EOF | osascript -
tell document 1 of application "BibDesk"
	set bibcodes to {}
	repeat with thePub in publications
		if (count (every field of thePub whose name is "Adsurl" and (value contains "arxiv" or value contains "astro.ph"))) > 0 then
			-- get bibcode from ADSurl
			set ADSurl to (value of every field of thePub whose name is "Adsurl")
			set AppleScript's text item delimiters to "/"
			set end of bibcodes to last text item of text item 1 of ADSurl
		end if
	end repeat
end tell
set AppleScript's text item delimiters to " "
return bibcodes as text
EOF
)

if [ "$bibcodes" == "" ]; then echo "Nothing to update!"; exit; fi
# check for changed bibcodes
nbibcodes=$(echo $bibcodes | wc -w)
python -c "import math;n=$nbibcodes;t=math.ceil(n*15./60.); print 'Checking %i ArXiv entries for changes...\n(to prevent ADS flooding this will take a while, check back in around %i %s)' % (n, t, t > 1 and 'minutes' or 'minute')"
python py.py -u $bibcodes
# python py.py -u $bibcodes --debug # DEBUG MODE

changed=$(wc -l changed_arxiv | awk '{print $1}')
if [ "$changed" -gt "0" ]
then
    echo ""; echo "Updating $changed entries, continue? (y/[n])"
    read -n1 -s continue
else
    echo ""; echo "Nothing to update!"
    exit
fi
if [ "$continue" != "Y" ] && [ "$continue" != "y" ]
then exit
fi

echo "(to prevent ADS flooding, we will wait for a while between each update, so go grab a coffee)"
# update bibcodes
for bibcode in `cat changed_arxiv`; do
    echo "Updating $bibcode..."
    # sleep 1 minute if updating a lot of stuff, if not wait only 10s
    if [ "$changed" -gt "10" ]
    then
        sleep 60
    else
        sleep 15
    fi
    osascript scpt.scpt `python py.py ${bibcode}`
done

#clean up
cd - > /dev/null
rm -rf $tmpdir
