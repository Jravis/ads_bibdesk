#!/bin/sh
# ADS to BibDesk -- frictionless import of ADS publications into BibDesk
# Copyright (C) 2011  Rui Pereira <rui.pereira@gmail.com>
# 
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.

# ugliest hack in the world - harcoded/compressed strings of both applescript and python scripts as in the automator actions
py="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"
scpt="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"
tmpdir=$(python -c "import tempfile; print tempfile.mkdtemp()")
python -c "import binascii,zlib;\
           out=open('${tmpdir}/py.py', 'w'); print >> out, zlib.decompress(binascii.a2b_base64('${py}')); \
           out=open('${tmpdir}/scpt.scpt', 'w'); print >> out, zlib.decompress(binascii.a2b_base64('${scpt}'))"

# go the tmp directory
cd $tmpdir

# fetch arXiv bibcodes from BibDesk using an applescript
bibcodes=$(cat << EOF | osascript -
tell document 1 of application "BibDesk"
	set bibcodes to {}
	repeat with thePub in publications
		if (count (every field of thePub whose name is "Adsurl" and (value contains "arxiv" or value contains "astro.ph"))) > 0 then
			-- get bibcode from ADSurl
			set ADSurl to (value of every field of thePub whose name is "Adsurl")
			set AppleScript's text item delimiters to "/"
			set end of bibcodes to last text item of text item 1 of ADSurl
		end if
	end repeat
end tell
set AppleScript's text item delimiters to " "
return bibcodes as text
EOF
)

if [ "$bibcodes" == "" ]; then echo "Nothing to update!"; exit; fi
# check for changed bibcodes
nbibcodes=$(echo $bibcodes | wc -w)
python -c "import math;n=$nbibcodes;t=math.ceil(n*15./60.); print 'Checking %i ArXiv entries for changes...\n(to prevent ADS flooding this will take a while, check back in around %i %s)' % (n, t, t > 1 and 'minutes' or 'minute')"
python py.py -u $bibcodes
# python py.py -u $bibcodes --debug # DEBUG MODE

changed=$(wc -l changed_arxiv | awk '{print $1}')
if [ "$changed" -gt "0" ]
then
    echo ""; echo "Updating $changed entries, continue? (y/[n])"
    read -n1 -s continue
else
    echo ""; echo "Nothing to update!"
    exit
fi
if [ "$continue" != "Y" ] && [ "$continue" != "y" ]
then exit
fi

echo "(to prevent ADS flooding, we will wait for a while between each update, so go grab a coffee)"
# update bibcodes
for bibcode in `cat changed_arxiv`; do
    echo "Updating $bibcode..."
    # sleep 1 minute if updating a lot of stuff, if not wait only 10s
    if [ "$changed" -gt "10" ]
    then
        sleep 60
    else
        sleep 15
    fi
    osascript scpt.scpt `python py.py ${bibcode}`
done

#clean up
cd - > /dev/null
rm -rf $tmpdir
